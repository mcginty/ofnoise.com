this.audioLib=function AUDIOLIB(m,k,y,s){function n(h){h=new ea(h);h.subarray=h.subarray||h.slice;return h}function w(h,a,b,c){K?K(h,a,{get:function(){return b},enumerable:!!c}):h[a]=b}function T(h){var a=arguments,b=a.length,c,e;for(c=1;c<b;c++)for(e in a[c])a[c].hasOwnProperty(e)&&(h[e]=a[c][e]);return h}function O(h,a,b){var c;if(!b)if(b=[],c=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(a))c[1].replace(/[a-z$_0-9]+/ig,function(c){b.push(c)});else for(c=0;c<a.length;c++)b[c]=s(c+2).join("_");h=Function("var __q;return function "+
h+"("+b.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+h+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+h+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")();h.prototype=a.prototype;h.prototype.__CLASSCONSTRUCTOR=a;T(h,a);return h}function P(h,a,b,c){this.parameter=h;this.automation=a;this.amount=isNaN(b)?this.amount:b;this.setType(c)}function u(h,a,b,c,e){if(!h.automation)switch(h.automation=[],h.type){case "generator":h.append=u.generatorAppend;break;case "effect":h.append=
u.effectAppend;break;case "buffereffect":h.append=u.bufferEffectAppend}b=new P(a,b,c,e);h.automation.push(b);return b}function U(h,a,b){function c(){h.apply(this,b)}this.channelCount=isNaN(a)?this.channelCount:a;this.effects=[];for(c.prototype=h.prototype;a--;)this.effects.push(new c)}function z(h,a){var b=h[0].toUpperCase()+h.substr(1).toLowerCase();z[h]=a;a.decode&&(j.Sampler.prototype["load"+b]=function(c){this.load.apply(this,[z[h].decode(c)].concat([].slice.call(arguments,1)))});a.encode&&(j.AudioDevice.Recording.prototype["to"+
b]=function(c){return z[h].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:c})});return a}function Q(){}function R(){}function B(h,a){B[h]=a;B._pluginList.push({plugin:a,name:h})}function V(h,a,b,c,e,d,g){this.sampleRate=isNaN(h)?this.sampleRate:h;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?this.decay:b;this.sustain=isNaN(c)?this.sustain:c;this.release=isNaN(e)?this.release:e;this.sustainTime=isNaN(d)?null:d;this.releaseTime=
isNaN(g)?null:g}function W(h,a,b,c){this.sampleRate=isNaN(h)?this.sampleRate:h;this.stepLength=isNaN(a)?this.stepLength:a;this.steps=b||[1,0];this.attack=isNaN(c)?this.attack:c}function X(h,a){this.sampleRate=isNaN(h)?this.sampleRate:h;this.schedule=[];this.reset(a)}function p(h,a,b,c,e,d){this.reset.apply(this,arguments)}function Y(h,a,b,c){this.sampleRate=h;this.buffer=new n(isNaN(a)?1200:a);this.bufferSize=this.buffer.length;this.feedback=isNaN(b)?this.feedback:b;this.damping=isNaN(c)?this.damping:
c;this.invDamping=1-this.damping}function Z(h,a){this.sampleRate=isNaN(h)?this.sampleRate:h;this.setParam("kernels",a||new n(1))}function E(h,a,b){this.time=isNaN(a)?this.time:a;this.feedback=isNaN(b)?this.feedback:b;this.reset(h)}function v(h,a,b,c,e,d,g){var f=this;f.sampleRate=h;f.channelCount=isNaN(a)?f.channelCount:a;f.wet=isNaN(b)?f.wet:b;f.dry=isNaN(c)?f.dry:c;f.roomSize=isNaN(e)?f.roomSize:e;f.damping=isNaN(d)?f.damping:d;f.tuning=new v.Tuning(g||f.tuning);f.sample=function(){var c=[],b;for(b=
0;b<f.channelCount;b++)c[b]=0;return c}();f.CFs=function(){var c=[],b=[],a=f.tuning.combCount,e=f.damping*f.tuning.scaleDamping,d=f.roomSize*f.tuning.scaleRoom+f.tuning.offsetRoom,g=f.tuning.combTuning,h,k;for(k=0;k<f.channelCount;k++){for(h=0;h<a;h++)b.push(new j.CombFilter(f.sampleRate,g[h]+k*f.tuning.stereoSpread,d,e));c.push(b);b=[]}return c}();f.numCFs=f.CFs[0].length;f.APFs=function(){var c=[],b=[],a=f.tuning.allPassCount,e=f.tuning.allPassFeedback,d=f.tuning.allPassTuning,g,h;for(h=0;h<f.channelCount;h++){for(g=
0;g<a;g++)b.push(new v.AllPassFilter(f.sampleRate,d[g]+h*f.tuning.stereoSpread,e));c.push(b);b=[]}return c}();f.numAPFs=f.APFs[0].length}function $(h,a){this.sampleRate=isNaN(h)?this.sampleRate:h;this.gain=isNaN(a)?this.gain:a}function F(h,a,b,c){var e=this,d=[0,0,0,0],g,f,i,l,t=k.sin,S=k.min,j=k.pow;e.cutoff=isNaN(a)?2E4:a;e.resonance=!b?0.1:b;e.samplerate=isNaN(h)?44100:h;e.type=c||0;e.pushSample=function(c){if(i!==e.cutoff||l!==e.resonance)g=2*t(k.PI*S(0.25,e.cutoff/(2*e.samplerate))),f=S(2*(1-
j(e.resonance,0.25)),S(2,2/g-0.5*g)),i=e.cutoff,l=e.resonance;d[3]=c-f*d[2];d[0]+=g*d[2];d[1]=d[3]-d[0];d[2]=g*d[1]+d[2];d[3]=c-f*d[2];d[0]+=g*d[2];d[1]=d[3]-d[0];d[2]=g*d[1]+d[2];return d[e.type]};e.getMix=function(c){return d[c||e.type]}}function aa(h,a,b,c){this.sampleRate=isNaN(h)?this.sampleRate:h;this.threshold=isNaN(a)?this.threshold:a;this.attack=isNaN(b)?this.attack:b;this.release=isNaN(c)?this.release:c;this._amplitude=new j.Amplitude(this.sampleRate,this.attack,this.release)}function ba(){this.reset.apply(this,
arguments)}function G(h,a){this.frequency=isNaN(a)?440:a;this.waveTable=new n(1);this.sampleRate=h;this.waveShapes=this.waveShapes.slice(0)}function ca(h,a){this.voices=[];this.sampleRate=h;this.pitch=isNaN(a)?440:this.pitch}function da(h,a,b){this.sampleRate=isNaN(h)?this.sampleRate:h;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?this.decay:b}function D(h){for(var a in D.prototype)D.prototype.hasOwnProperty(a)&&(this[a]=D.prototype[a]);this.resetBuffer.apply(this,arguments)}var ea=m.Float32Array||
s,j=this;j.Float32Array=n;var K=function(){if(y.defineProperty)return y.defineProperty;if(y.prototype.__defineGetter__)return function(h,a,b){b.get&&h.__defineGetter__(a,b.get);b.set&&h.__defineSetter__(a,b.set)}}();w(j,"__define",K);w(j,"__defineConst",w);w(j,"__extend",T);w(j,"__enum",function(h,a,b){for(var c in h)(h.hasOwnProperty(c)||b)&&a.call(h,h[c],c);return h});w(j,"__class",O);P.prototype={parameter:"",automation:null,amount:1,type:"modulation",mode:null,setType:function(h){if(h){if("function"===
typeof h)this.type=h.name||"custom",this.mode=h;this.type=h;this.mode=u.modes[h]}else this.mode=this.mode||u.modes[this.type]}};u.generatorAppend=function(h,a,b){var c=h.length,e=this.automation.length,d=[],g,f,i,l,b=b||h,a=a||this.channelCount;for(i=0;i<e;i++)d.push(this[this.automation[i].parameter]);for(f=0,g=0;f<c;f+=a,g++){for(i=0;i<e;i++)this[this.automation[i].parameter]=d[i];for(i=0;i<e;i++)l=this.automation[i],l.mode(this,l.parameter,l.amount*l.automation.generatedBuffer[g]);this.generate();
for(i=0;i<a;i++)b[f+i]=this.getMix(i)*this.mix+h[f+i]}for(i=0;i<e;i++)this[this.automation[i].parameter]=d[i];return b};u.effectAppend=function(h,a,b){var c=h.length,e=this.automation.length,d=[],g,f,i,l,b=b||h,a=a||this.channelCount;for(i=0;i<e;i++)d.push(this[this.automation[i].parameter]);for(f=0,g=0;f<c;f+=a,g++){for(i=0;i<e;i++)this[this.automation[i].parameter]=d[i];for(i=0;i<e;i++)l=this.automation[i],l.mode(this,l.parameter,l.amount*l.automation.generatedBuffer[g]);for(i=0;i<a;i++)this.pushSample(h[f+
i],i),b[f+i]=this.getMix(i)*this.mix+h[f+i]*(1-this.mix)}for(i=0;i<e;i++)this[this.automation[i].parameter]=d[i];return b};u.bufferEffectAppend=function(h,a,b){var a=a||this.channelCount,c=h.length,e=this.automation.length,d=[],g,f,i,l,t,b=b||h;for(i=0;i<e;i++){d.push([]);for(f=0;f<a;f++)d[i].push(this.effects[f][this.automation[i].parameter])}for(t=0,g=0;g<c;g+=a,t++)for(f=0;f<a;f++){for(i=0;i<e;i++)l=this.automation[i],this.effects[f][l.parameter]=d[i][f],l.mode(this.effects[f],l.parameter,l.amount*
l.automation.generatedBuffer[t]);b[g+f]=this.effects[f].pushSample(h[g+f])*this.mix+h[g+f]*(1-this.mix)}for(i=0;i<e;i++)for(f=0;f<a;f++)this.effects[f][this.automation[i].parameter]=d[i][f];return b};u.modes={modulation:function(h,a,b){h.setParam(a,h[a]*b)},addition:function(h,a,b){h.setParam(a,h[a]+b)},subtraction:function(h,a,b){h.setParam(a,h[a]-b)},additiveModulation:function(h,a,b){h.setParam(a,h[a]+h[a]*b)},subtractiveModulation:function(h,a,b){h.setParam(a,h[a]-h[a]*b)},assignment:function(h,
a,b){h.setParam(a,b)},absoluteAssignment:function(h,a,b){h.setParam(a,k.abs(b))}};u.__constructror=P;U.prototype={mix:0.5,type:"buffereffect",channelCount:2,append:function(h,a,b){var c=h.length,e,d,a=a||this.channelCount,b=b||h;for(e=0;e<c;e+=a)for(d=0;d<a;d++)this.effects[d].pushSample(h[e+d],0),b[e+d]=this.effects[d].getMix(0)*this.mix+h[e+d]*(1-this.mix);return b},addPreProcessing:function(){var h;for(h=0;h<this.effects.length;h++)this.effects[h].addPreProcessing.apply(this.effects[h],arguments)},
removePreProcessing:function(){var h;for(h=0;h<this.effects.length;h++)this.effects[h].removePreProcessing.apply(this.effects[h],arguments)},setParam:function(h,a){var b=this.effects.length,c;for(c=0;c<b;c++)this.effects[c].setParam(h,a)}};Q.prototype={type:"effect",sink:!0,source:!0,mix:0.5,channelCount:1,append:function(h,a,b){var c=h.length,e,d,b=b||h,a=a||this.channelCount;for(e=0;e<c;e+=a)for(d=0;d<a;d++)this.pushSample(h[e+d],d),b[e+d]=this.getMix(d)*this.mix+h[e+d]*(1-this.mix);return b},addPreProcessing:function(h){h.pushSample=
this.pushSample;this.pushSample=function(){h.apply(this,arguments);return h.pushSample.apply(this,arguments)}},removePreProcessing:function(h){for(var a;a=this.pushSample.pushSample;)if(a===h||!h)this.pushSample=a,h.pushSample=null},setParam:function(h,a){this[h]=a},pushSample:function(){},getMix:function(){},reset:function(){}};R.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(h,a,b){var c=h.length,e,d,b=b||h,a=a||this.channelCount;for(e=0;e<c;e+=a){this.generate();
for(d=0;d<a;d++)b[e+d]=this.getMix(d)*this.mix+h[e+d]}return b},addPreProcessing:function(h){h.generate=this.generate;this.generate=function(){h.apply(this,arguments);return h.generate.apply(this,arguments)}},removePreProcessing:function(h){for(var a;a=this.generate.generate;)if(a===h||!h)this.generate=a,h.generate=null},generateBuffer:function(h,a){this.generatedBuffer=new n(h);this.append(this.generatedBuffer,a||1)},setParam:function(h,a){this[h]=a},generate:function(){},getMix:function(){},reset:function(){}};
w(B,"_pluginList",[],!1);V.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){this.states[this.state].call(this);return this.value},getMix:function(){return this.value},triggerGate:function(h){this.state=(this.gate=h="undefined"===typeof h?!this.gate:h)?0:null===this.releaseTime?3:5;this._st=0},states:[function(){this.value+=1E3/this.sampleRate/this.attack;if(1<=this.value)this.state=1},function(){this.value-=
1E3/this.sampleRate/this.decay*this.sustain;if(this.value<=this.sustain)null===this.sustainTime?this.state=2:(this._st=0,this.state=4)},function(){this.value=this.sustain},function(){this.value=k.max(0,this.value-1E3/this.sampleRate/this.release)},function(){this.value=this.sustain;if(this._st++>=0.0010*this.sampleRate*this.sustainTime)this._st=0,this.state=null===this.releaseTime?3:5},function(){this.value=k.max(0,this.value-1E3/this.sampleRate/this.release);if(this._st++>=0.0010*this.sampleRate*
this.releaseTime)this.state=this._st=0}]};W.prototype={sampleRate:44100,stepLength:200,steps:null,attack:0,phase:0,value:0,generate:function(){var h=this.steps,a=this.sampleRate/1E3*this.stepLength*h.length,b,c;this.phase=(this.phase+1)%a;b=this.phase/a*h.length;a=b%1;b=~~b;c=h[b]-h[(b||h.length)-1];h=h[b];a<this.attack&&(h-=c-c/this.attack*a);return this.value=h},getMix:function(){return this.value},triggerGate:function(){this.phase=0}};X.prototype={sampleRate:44100,value:1,schedule:null,clock:0,
getMix:function(){return this.value},generate:function(){var h;for(h=0;h<this.schedule.length;h++)if(this.schedule[h].t--)this.value=this.schedule[h].v,this.schedule.splice(h--,1)},setValue:function(h){this.schedule.push({v:h,t:~~((+new Date-this.clock)/1E3*this.sampleRate)})},reset:function(h){this.value=isNaN(h)?this.value:h;this.clock=+new Date}};p.BiquadFilterClass=function a(){for(var b in a.prototype)a.prototype.hasOwnProperty&&(this[b]=this[b])};p.BiquadFilterClass.prototype={sampleRate:44100,
sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(a){var b=this.coefs,c=this.inputs,e=this.outputs;this.sample=b.b0*a+b.b1*c[0]+b.b2*c[1]-b.a1*e[0]-b.a2*e[1];c.pop();c.unshift(a);e.pop();e.unshift(this.sample);return this.sample},getMix:function(){return this.sample},reset:function(a,b,c,e,d,g){this.inputs=[0,0];this.outputs=[0,0];this.sampleRate=isNaN(a)?this.sampleRate:a;if(1<arguments.length)this.coefs={b0:b,b1:c,b2:e,a1:d,a2:g}}};p.LowPass=function(a,b,c){var e=2*k.PI*b/a,b=k.cos(e),
c=k.sin(e)/(2*c),e=(1-b)/2,d=1+c;this.reset(a,e/d,(1-b)/d,e/d,-2*b/d,(1-c)/d)};p.HighPass=function(a,b,c){var e=2*k.PI*b/a,b=k.cos(e),c=k.sin(e)/(2*c),e=(1+b)/2,d=1+c;this.reset(a,e/d,-(1+b)/d,e/d,-2*b/d,(1-c)/d)};p.AllPass=function(a,b,c){var e=2*k.PI*b/a,b=k.cos(e),e=k.sin(e)/(2*c),c=1-e,b=-2*b,e=1+e;this.reset(a,c/e,b/e,e/e,b/e,c/e)};p.BandPass=function(a,b,c){var e=2*k.PI*b/a,b=k.cos(e),d=k.sin(e),c=k.log(2)/2*c*e/d,c=d*(k.exp(c)-k.exp(-c))/2,d=1+c;this.reset(a,c/d,0/d,-c/d,-2*b/d,(1-c)/d)};(function(a,
b){for(b=0;b<a.length;b++)a[b].prototype=new p.BiquadFilterClass})([p,p.LowPass,p.HighPass,p.AllPass,p.BandPass]);Y.prototype={sample:0,index:0,store:0,feedback:0.84,damping:0.2,pushSample:function(a){this.sample=this.buffer[this.index];this.store=this.sample*this.invDamping+this.store*this.damping;this.buffer[this.index++]=a+this.store*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},reset:function(){this.samples=this.index=this.store=
0;this.buffer=new n(this.bufferSize)},setParam:function(a,b){switch(a){case "damping":this.damping=b;this.invDamping=1-b;break;default:this[a]=b}}};Z.prototype={sampleRate:44100,sample:0,pos:0,kernels:null,buffer:null,pushSample:function(a){var b,c;this.sample=0;this.buffer[this.pos]=a;for(b=0,c=this.buffer.length,a=this.pos+c;b<c;b++)this.sample+=this.kernels[b]*this.buffer[(a-b)%c];this.pos=(this.pos+1)%this.buffer.length},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case "kernels":this.buffer=
new n(b.length),this.pos=0}this[a]=b}};E.prototype={sampleRate:1,time:1E3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(a){var b=this.buffer;b[this.bufferPos++]+=a;if(this.bufferPos>this.time*this._rstf)this.bufferPos=0;this.sample=b[this.bufferPos];b[this.bufferPos]*=this.feedback;return this.sample},getMix:function(){return this.sample},resample:function(a){var b=this.time/a;this.buffer=j.Sink.resample(this.buffer,a);this.time=a;this.bufferPos=k.round(b*this.bufferPos);
return this.buffer},reset:function(a,b){var c=this.buffer,e,a=isNaN(a)?this.sampleRate:a;e=this.sampleRate/a;this.buffer=new n(a*E.MAX_DELAY);this.bufferPos=k.round(e*this.bufferPos);this._rstf=0.0010*a;if(b){c=j.Sink.resample(c,e);for(e=0;e<c.length&&e<this.buffer.length;e++)this.buffer[e]=c[e]}return this.buffer}};E.MAX_DELAY=2;v.prototype={channelCount:2,sample:[0,0],wet:0.5,dry:0.55,damping:0.2223,roomSize:0.5,tuning:{},pushSample:function(a,b){var c=a*this.tuning.fixedGain,e=0,d;for(d=0;d<this.numCFs;d++)e+=
this.CFs[b][d].pushSample(c);for(d=0;d<this.numAPFs;d++)e=this.APFs[b][d].pushSample(e);this.sample[b]=e*this.wet+a*this.dry},getMix:function(a){return this.sample[a]},reset:function(){var a,b;for(b=0;b<this.channelCount;b++){for(a=0;a<this.numCFs;a++)this.CFs[b][a].reset();for(a=0;a<this.numAPFs;a++)this.APFs[b][a].reset();this.sample[b]=0}},setParam:function(a,b){var c,e,d;switch(a){case "roomSize":this.roomSize=b;c=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom;for(d=0;d<this.channelCount;d++)for(e=
0;e<this.numCFs;e++)this.CFs[d][e].setParam("feedback",c);break;case "damping":this.damping=b;c=this.damping*this.tuning.scaleDamping;for(d=0;d<this.channelCount;d++)for(e=0;e<this.numCFs;e++)this.CFs[d][e].setParam("damping",c);break;default:this[a]=b}}};v.Tuning=function(a){var b;if(a)for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};v.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:0.5,fixedGain:0.015,
scaleDamping:0.9,scaleRoom:0.28,offsetRoom:0.7,stereoSpread:23};v.AllPassFilter=function(a,b,c){this.sampleRate=a;this.buffer=new n(isNaN(b)?500:b);this.bufferSize=this.buffer.length;this.feedback=isNaN(c)?this.feedback:c};v.AllPassFilter.prototype={sample:0,index:0,feedback:0.5,pushSample:function(a){bufOut=this.buffer[this.index];this.sample=-a+bufOut;this.buffer[this.index++]=a+bufOut*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},
reset:function(){this.sample=this.index=0;this.buffer=new n(this.bufferSize)}};$.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(a){return this.sample=a*this.gain},getMix:function(){return this.sample}};aa.prototype={sampleRate:44100,threshold:0.95,attack:0.01,release:0.01,__amplitude:null,sample:0,pushSample:function(a){var b=this._amplitude.pushSample(a)-this.threshold;return this.sample=0<b?a/(1+b):a},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case "attack":case "release":this._amplitude[a]=
b;default:this[a]=b}}};ba.prototype={sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a;this.color="string"===typeof b?b:this.color;this.c1=(1<<this.q)-1;this.c2=~~(this.c1/3)+1;this.c3=1/this.c1;this.c1=6*this.c2;this.c4=3*(this.c2-1);this.q0=k.exp(-200*k.PI/this.sampleRate);this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},
white:function(){return(k.random()*this.c1-this.c4)*this.c3},pink:function(){var a=this.white();this.b0=0.997*this.b0+0.029591*a;this.b1=0.985*this.b1+0.032534*a;this.b2=0.95*this.b2+0.048056*a;this.b3=0.85*this.b3+0.090579*a;this.b4=0.62*this.b4+0.10899*a;this.b5=0.25*this.b5+0.255784*a;return 0.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){this.brownQ=this.q1*this.white()+this.q0*this.brownQ;return 6.2*this.brownQ}};(function(a,b,c,e){c=G.prototype={sampleRate:44100,frequency:440,
phaseOffset:0,pulseWidth:0.5,fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var c=+this.frequency,b=this.pulseWidth,a=this.phase,c=c+c*this.fm;this.phase=(a+c/this.sampleRate/2)%1;a=(this.phase+this.phaseOffset)%1;this._p=a<b?a/b:(a-b)/(1-b)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(c){this.phase=this._p=isNaN(c)?0:c},setWavetable:function(c){this.waveTable=c;return!0},sine:function(){return k.sin(this._p*a)},triangle:function(){return 0.5>
this._p?4*this._p-1:3-4*this._p},square:function(){return 0.5>this._p?-1:1},sawtooth:function(){return 1-2*this._p},invSawtooth:function(){return 2*this._p-1},pulse:function(){return 0.5>this._p?0.25>this._p?8*this._p-1:1-8*(this._p-0.25):-1},wavetable:function(){return j.Sink.interpolate(this.waveTable,this._p*this.waveTable.length)},waveShapes:[]};for(e=0;e<b.length;e++)c[e]=c[b[e]],c.waveShapes.push(c[e]);G.WaveShape=function(c,b){b&&(this.prototype[c]=b);return this.prototype[c]};G.createMixWave=
function(c,b){var a=b.length,e,l;return this.WaveShape(c,function(){for(l=e=0;l<a;l++)e+=this[b[l].shape]()*b[l].mix;return e})}})(2*k.PI,"sine,triangle,pulse,sawtooth,invSawtooth,square".split(","));ca.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(a,b){var a=isNaN(a)?this.pitch:a,c=this.sampleRate,e=this.sampleSize-c*this.delayEnd-1,c={f:a,p:c*this.delayStart,s:a/this.pitch,l:e,v:isNaN(b)?1:
b};for(this.voices.push(c);this.voices.length>this.maxVoices;)e=this.voices.shift(),e.onend&&e.onend();return c},generate:function(){var a=this.voices,b,c;for(b=0;b<a.length;b++)c=a[b],c.p+=c.s,c.p>c.l&&a.splice(b--,1)&&c.onend&&c.onend()},getMix:function(a){var b=this.voices,c=0,e,a=a||0;if(this.samples[a])for(e=0;e<b.length;e++)c+=j.Sink.interpolate(this.samples[a],b[e].p)*b[e].v;return c},load:function(a,b){var c=this.samples=j.Sink.deinterleave(a.data,a.channelCount),e;if(b)for(e=0;e<c.length;e++)c[e]=
j.Sink.resample(c[e],a.sampleRate,this.sampleRate);this.sample=a.data;this.samples=c;this.data=a;this.sampleSize=c[0].length}};(function(){function a(){var b=arguments,c=b.length,a,d;for(d=0;d<c;d++)a=b[d],this.postMessage({type:"injection",code:a instanceof Function?"("+a+").call(this);":a})}j.AudioWorker=function(b,c){var e="var audioLib=("+AUDIOLIB+").call({},this,Math,Object,Array);\n",d;for(d=0;d<j.plugins._pluginList.length;d++)e+="("+j.plugins._pluginList[url]+"());\n";c&&(e+='this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)},true);\n');
e+=b instanceof Function?"("+b+").call(this);":b.textContent||b;e=fa.inlineWorker(e);if(c)e.inject=a;return e}})();(function(a,b){function c(b,a){return a?g(b&255)+c(b>>8,a-1):""}function e(c,b){return b?e(c>>8,b-1)+g(255-c&255):""}function d(c,a,e,g){var k=b.pow,j=b.floor,C=d.convertFromBinary,n=d.convertToBinary,x=c/8,r=k(2,c),o=r/2,m=o-1,s=1/o,p=1/m;return g?e?a?function(c,b){c=j(0>c?c*o+r:c*m);return n(c,x,b)}:function(c,b){return n(j(c*m),x,b)}:a?function(c,b){return n(0>c?c+r:c,x,b)}:function(c,
b){return n(c,x,b)}:e?a?function(c,b){var a=C(c,b);return a>m?(a-r)*s:a*p}:function(c,b){return C(c,b)*p}:a?function(c,b){var a=C(c,b);return a>m?a-r:a}:function(c,b){return C(c,b)}}var g=String.fromCharCode;d.convertToBinary=function(b,a,d){return d?e(b,a):c(b,a)};d.convertFromBinary=function(c,a){var e=c.length,d=e-1,g=0,k=b.pow,j;if(a)for(j=0;j<e;j++)g+=(255-c.charCodeAt(j))*k(256,d-j);else for(j=0;j<e;j++)g+=c.charCodeAt(j)*k(256,j);return g};d.fromQ32=d(32,!0,!0,!0);d.toQ32=d(32,!0,!0,!1);d.fromQ24=
d(24,!0,!0,!0);d.toQ24=d(24,!0,!0,!1);d.fromQ16=d(16,!0,!0,!0);d.toQ16=d(16,!0,!0,!1);d.fromQ8=d(8,!0,!0,!0);d.toQ8=d(8,!0,!0,!1);d.fromInt32=d(32,!0,!1,!0);d.toInt32=d(32,!0,!1,!1);d.fromInt16=d(16,!0,!1,!0);d.toInt16=d(16,!0,!1,!1);d.fromInt8=d(8,!0,!1,!0);d.toInt8=d(8,!0,!1,!1);d.fromUint32=d(32,!1,!1,!0);d.toUint32=d(32,!1,!1,!1);d.fromUint16=d(16,!1,!1,!0);d.toUint16=d(16,!1,!1,!1);d.fromUint8=d(8,!1,!1,!0);d.toUint8=d(8,!1,!1,!1);a.Binary=d})(this,k);(function(a,b){function c(c){this.data=c}
function e(c,b,a){var e=b/8;d["read"+c+b]=function(c){return a(this.read(e),c)}}var d=c.prototype={read:function(c){var b=this.data.substr(0,c);this.skip(c);return b},skip:function(c){var b=this.data=this.data.substr(c);this.pointer+=c;return b.length},readBuffer:function(c,b,a){for(var b="read"+a+b,a=c.length,e=0;this.data&&e<a;)c[e++]=this[b]();return e}},g,f;for(g in b)(f=/to([a-z]+)([0-9]+)/i.exec(g))&&e(f[1],f[2],b[g]);a.Stream=c;c.newType=e})(this,this.Binary);this.PCMData=function(a,b){function c(b){return("string"===
typeof b?c.decode:c.encode)(b)}c.decodeFrame=function(c,a,g){if(8===a){var f=new (window.Uint8Array||s)(g.length);(new b(c)).readBuffer(f,8,"Uint");for(a=0;a<g.length;a++)g[a]=127.5*(f[a]-127.5)}else(new b(c)).readBuffer(g,a,"Q");return g};c.encodeFrame=function(c,b){var g=a[(8===b?"fromUint":"fromQ")+b],f=c.length,i="",l;if(8===b)for(l=0;l<f;l++)i+=g(127.5*c[l]+127.5);else for(l=0;l<f;l++)i+=g(c[l]);return i};c.decode=function(a,d){function g(){C=f.read(4);m=f.readUint32();r=f.read(m);p=u[C]=u[C]||
[];"data"===C?(x=~~(m/k),o=A.data=new ("undefined"!==typeof n?n:s)(x),c.decodeFrame(r,8*k,o)):p.push(r);d&&(f.data?setTimeout(g,1):d(A))}var f=new b(a);f.read(4);var i=f.readUint32(),f=new b(f.read(i));f.read(4);f.read(4);i=f.readUint32();i=new b(f.read(i));i.readUint16();var l=i.readUint16();i.readUint32();var t=i.readUint32(),j=i.readUint16(),k=j/l;i.readUint16();var C,m,x,r,o,p,u={},A={channelCount:l,bytesPerSample:j/l,sampleRate:t/j,chunks:u,data:o};if(d)f.data?g():d(A);else for(;f.data;)g();
return A};c.encode=function(b,d){var g=a.fromUint32,f=a.fromUint16,i=b.data,l=b.sampleRate,t=b.channelCount||1,j=b.bytesPerSample||1,n=8*j,m=t*j,p=l*m,x=i.length*j;k.pow(2,n-1);var r=[],j="",o;r.push("fmt "+g(16)+f(1)+f(t)+g(l)+g(p)+f(m)+f(n));r.push("data"+g(x)+c.encodeFrame(i,n));if(l=b.chunks)for(o in l)if(l.hasOwnProperty(o)){f=l[o];for(i=0;i<f.length;i++)j=f[i],r.push(o+g(j.length)+j)}r=r.join("");r="RIFF"+g(r.length)+"WAVE"+r;d&&setTimeout(function(){d(r)},1);return r};return c}(this.Binary,
this.Stream);var fa=this.Sink=function(a){function b(c,a,e,i){var l=b.sinks.list,j;for(j=0;j<l.length;j++)if(l[j].enabled)try{return new l[j](c,a,e,i)}catch(k){}throw b.Error(2);}function c(){}function e(c,a,f,i,l){f=f||a.prototype;a.prototype=new b.SinkClass;a.prototype.type=c;a.enabled=!i;for(i in f)f.hasOwnProperty(i)&&(a.prototype[i]=f[i]);e[c]=a;e.list[l?"unshift":"push"](a)}b.SinkClass=c;c.prototype=b.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,
channelMode:"interleaved",isReady:!1,start:function(c,a,e,i){this.channelCount=isNaN(a)||null===a?this.channelCount:a;this.bufferSize=isNaN(e)||null===e?this.bufferSize:e;this.sampleRate=isNaN(i)||null===i?this.sampleRate:i;this.readFn=c;this.activeRecordings=[];this.previousHit=+new Date;b.EventEmitter.call(this);b.emit("init",[this].concat([].slice.call(arguments)))},process:function(c,a){this.emit("preprocess",arguments);this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,
arguments);if("interleaved"===this.channelMode)this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var e=b.deinterleave(c,this.channelCount),i=[e].concat([].slice.call(arguments,1));this.emit("audioprocess",i);this.readFn&&this.readFn.apply(this,i);b.interleave(e,this.channelCount,c)}this.emit("postprocess",arguments);this.previousHit=+new Date;this.writePosition+=c.length/a},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){if(!this.isReady)this.isReady=
!0,this.emit("ready",[])}};b.sinks=b.devices=e;b.sinks.list=[];b.singleton=function(){var c=b.apply(null,arguments);b.singleton=function(){return c};return c};return a.Sink=b}(function(){return this}());(function(a){function b(){for(var c in b.prototype)b.prototype.hasOwnProperty(c)&&(this[c]=b.prototype[c]);this._listeners={}}b.prototype={_listeners:null,emit:function(c,b){if(this._listeners[c])for(var a=0;a<this._listeners[c].length;a++)this._listeners[c][a].apply(this,b);return this},on:function(c,
b){this._listeners[c]=this._listeners[c]||[];this._listeners[c].push(b);return this},off:function(c,b){if(this._listeners[c]){if(!b)return delete this._listeners[c],this;for(var a=0;a<this._listeners[c].length;a++)this._listeners[c][a]===b&&this._listeners[c].splice(a--,1);this._listeners[c].length||delete this._listeners[c]}return this}};a.EventEmitter=b;b.call(a)})(this.Sink);(function(a){function b(c){if(!b.hasOwnProperty(c))throw b(1);if(!(this instanceof b))return new b(c);for(var a in b[c])b[c].hasOwnProperty(a)&&
(this[a]=b[c][a]);this.code=c}b.prototype=Error();b.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message};b[1]={message:"No such error code.",explanation:"The error code does not exist."};b[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."};b[16]={message:"Buffer underflow.",explanation:"Trying to recover..."};b[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."};
b[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."};a.Error=b})(this.Sink);(function(a){function b(a){var g=null,f,i;try{return i=new c,i.append(a),f=e.createObjectURL(i.getBlob()),g=new Worker(f),g._terminate=g.terminate,g._url=f,i=null,g.terminate=function(){this._terminate();e.revokeObjectURL(this._url)},b.type="blob",g}catch(l){}try{return g=new Worker("data:text/javascript;base64,"+
btoa(a)),b.type="data",g}catch(j){}return g}var c="undefined"===typeof window?void 0:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,e="undefined"===typeof window?void 0:window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL;b.ready=b.working=!1;a.EventEmitter.call(b);b.test=function(){function c(e){if(!b.ready)b.ready=!0,b.working=e,b.emit("ready",[e]),b.off("ready"),e&&a&&a.terminate(),a=null}var a=b("this.onmessage=function (e){postMessage(e.data)}");
b.ready=b.working=!1;a?(a.onmessage=function(b){c("inlineWorker"===b.data)},a.postMessage("inlineWorker"),setTimeout(function(){c(!1)},1E3)):c(!1)};a.inlineWorker=b;b.test()})(this.Sink);(function(a){a.doInterval=function(b,c){function e(e){a.inlineWorker.working&&!e?(d=a.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+c+");"),d.onmessage=function(){b()},g=function(){d.terminate()}):(d=setInterval(b,c),g=function(){clearInterval(d)})}var d,g;a.inlineWorker.ready?e():a.inlineWorker.on("ready",
function(){e()});return function(){g?g():a.inlineWorker.ready||a.inlineWorker.on("ready",function(){g&&g()})}}})(this.Sink);(function(a){a.sinks("audiodata",function(){function b(){if(d){f=g.mozWriteAudio(d);e+=f;if(f<d.length)return d=d.subarray(f);d=null}i=g.mozCurrentSampleOffset();l=Number(i+(k!==i?c.bufferSize:c.preBufferSize)*c.channelCount-e);i===k&&c.emit("error",[a.Error(16)]);if(0<l||k===i){c.ready();try{j=new n(k===i?c.preBufferSize*c.channelCount:c.forceBufferSize?l<2*c.bufferSize?2*c.bufferSize:
l:l)}catch(b){c.emit("error",[a.Error(18)]);c.kill();return}c.process(j,c.channelCount);f=c._audio.mozWriteAudio(j);f<j.length&&(d=j.subarray(f));e+=f}k=i}var c=this,e=0,d=null,g=new Audio,f,i,l,j,k;c.start.apply(c,arguments);c.preBufferSize=isNaN(arguments[4])||null===arguments[4]?this.preBufferSize:arguments[4];g.mozSetup(c.channelCount,c.sampleRate);this._timers=[];this._timers.push(a.doInterval(function(){if(2E3<+new Date-c.previousHit)c._audio=g=new Audio,g.mozSetup(c.channelCount,c.sampleRate),
e=0,c.emit("error",[a.Error(17)])},1E3));this._timers.push(a.doInterval(b,c.interval));c._bufferFill=b;c._audio=g},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:20,kill:function(){for(;this._timers.length;)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0);a.sinks.moz=a.sinks.audiodata})(this.Sink);(function(a,b){function c(c){var b=document.createElement("audio");if(c)b.src=c;return b}function e(){var b=
this;b.currentFrame=c();b.nextFrame=c();b._onended=function(){b.samples+=b.bufferSize;b.nextClip()}}b=a.sinks;b("wav",function(){function e(){g._audio.hasNextFrame||(g.ready(),a.memcpy(l,0,i,0),g.process(i,g.channelCount),g._audio.setSource("data:audio/wav;base64,"+btoa(j.PCMData.encode({data:i,sampleRate:g.sampleRate,channelCount:g.channelCount,bytesPerSample:g.quality}))),g._audio.currentFrame.src||g._audio.nextClip())}var g=this,f=new b.wav.wavAudio;g.start.apply(g,arguments);var i=new n(g.bufferSize*
g.channelCount),l=new n(g.bufferSize*g.channelCount);if(!c().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;g.kill=a.doInterval(e,40);g._bufferFill=e;g._audio=f},{quality:1,bufferSize:22050,getPlaybackTime:function(){var c=this._audio;return(c.currentFrame?c.currentFrame.currentTime*this.sampleRate:0)+c.samples}});e.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var c=this.currentFrame;this.currentFrame=this.nextFrame;this.nextFrame=c;this.hasNextFrame=
!1;this.currentFrame.play()},setSource:function(c){this.nextFrame.src=c;this.nextFrame.addEventListener("ended",this._onended,!0);this.hasNextFrame=!0}};b.wav.wavAudio=e})(this.Sink);(function(a){a.sinks("dummy",function(){function b(){var b=new n(c.bufferSize*c.channelCount);c.process(b,c.channelCount)}var c=this;c.start.apply(c,arguments);c._kill=a.doInterval(b,1E3*(c.bufferSize/c.sampleRate));c._callback=b},{kill:function(){this._kill();this.emit("kill")}},!0)})(this.Sink);(function(a,b){a("webaudio",
function(c,e,d,g){function f(c){var b=c.outputBuffer,c=b.numberOfChannels,a,e=b.length,d=new s(c);i.ready();k=k&&k.length===e*c?k:new n(e*c);m=m&&m.length===k.length?m:new n(e*c);k.set(m);for(a=0;a<c;a++)d[a]=b.getChannelData(a);i.process(k,i.channelCount);for(a=0;a<e;a++)for(b=0;b<c;b++)d[b][a]=k[a*i.channelCount+b]}var i=this,l=a.webaudio.getContext(),j=l.createJavaScriptNode(d,0,e),k=null,m=null;i.start.apply(i,arguments);i.sampleRate=l.sampleRate;j.onaudioprocess=f;j.connect(l.destination);i._context=
l;i._node=j;i._callback=f;b.push(j)},{kill:function(){this._node.disconnect(0);for(var c=0;c<b.length;c++)b[c]===this._node&&b.splice(c--,1);this._node=this._context=null;this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0);a.webkit=a.webaudio;a.webaudio.fix82795=b;a.webaudio.getContext=function(){var c=new (window.AudioContext||webkitAudioContext);a.webaudio.getContext=function(){return c};return c}})(this.Sink.sinks,[]);(function(a){a.sinks("worker",
function(){function b(c){a.isReady||a.initMSP(c);a.ready();var b=a.channelCount,d=c.audioLength,j,k;g=g&&g.length===d*b?g:new n(d*b);f=f&&f.length===g.length?f:new n(d*b);i=i&&i.length===g.length?i:new n(d*b);g.set(i);f.set(i);a.process(g,a.channelCount);for(j=0;j<b;j++)for(k=0;k<d;k++)f[j*c.audioLength+k]=g[j+k*b];c.writeAudio(f)}function c(c){a.isReady||a.initWA(c);a.ready();var b=c.outputBuffer,c=b.numberOfChannels,d,f=b.length,j=new s(c);g=g&&g.length===f*c?g:new n(f*c);i=i&&i.length===g.length?
i:new n(f*c);g.set(i);for(d=0;d<c;d++)j[d]=b.getChannelData(d);a.process(g,a.channelCount);for(d=0;d<f;d++)for(b=0;b<c;b++)j[b][d]=g[d*a.channelCount+b]}var a=this,d=function(){return this}(),g=null,f=null,i=null;a.start.apply(a,arguments);importScripts();d.onprocessmedia=b;d.onaudioprocess=c;a._mspBufferFill=b;a._waBufferFill=c},{ready:!1,initMSP:function(b){this.channelCount=b.audioChannels;this.sampleRate=b.audioSampleRate;this.bufferSize=b.audioLength*this.channelCount;this.ready=!0;this.emit("ready",
[])},initWA:function(b){b=b.outputBuffer;this.channelCount=b.numberOfChannels;this.sampleRate=b.sampleRate;this.bufferSize=b.length*this.channelCount;this.ready=!0;this.emit("ready",[])}})})(this.Sink);(function(a){(function(){function b(c,e){if(c&&e)b[c]=e;else if(c&&b[c]instanceof Function)a.interpolate=b[c];return b[c]}a.interpolation=b;b("linear",function(c,b){var a=k.floor(b),g=a+1,f=b-a,g=g<c.length?g:0;return c[a]*(1-f)+c[g]*f});b("nearest",function(c,b){return b>=c.length-0.5?c[0]:c[k.round(b)]});
b("linear")})();a.resample=function(b,c,e,d,g){var f=arguments.length,f=2===f?c:3===f?c/e:d/c*g/e,i=b.length,j=k.ceil(i/f),j=new n(j),t,m;for(t=0,m=0;t<i;t+=f)j[m++]=a.interpolate(b,t);return j}})(this.Sink);(function(a){a.deinterleave=function(b,c){var a=b.length/c,d=[],g,f;for(g=0;g<c;g++){d[g]=new n(a);for(f=0;f<a;f++)d[g][f]=b[f*c+g]}return d};a.interleave=function(b,c,a){var c=c||b.length,d=b[0].length,g=b.length,f,i,a=a||new n(d*c);for(f=0;f<g;f++)for(i=0;i<d;i++)a[f+i*c]=b[f][i];return a};
a.mix=function(b){var c=[].slice.call(arguments,1),a,d,g;for(g=0;g<c.length;g++){a=k.max(b.length,c[g].length);for(d=0;d<a;d++)b[d]+=c[g][d]}return b};a.resetBuffer=function(b){var c=b.length,a;for(a=0;a<c;a++)b[a]=0;return b};a.clone=function(b,c){var a=b.length,d,c=c||new n(a);for(d=0;d<a;d++)c[d]=b[d];return c};a.createDeinterleaved=function(b,c){var a=new s(c),d;for(d=0;d<c;d++)a[d]=new n(b);return a};a.memcpy=function(b,c,a,d,g){b=b.subarray||b.slice?b:b.buffer;a=a.subarray||a.slice?a:a.buffer;
b=c?b.subarray?b.subarray(c,g&&c+g):b.slice(c,g&&c+g):b;if(a.set)a.set(b,d);else for(c=0;c<b.length;c++)a[c+d]=b[c];return a};a.memslice=function(b,c,a){return b.subarray?b.subarray(c,a):b.slice(c,a)};a.mempad=function(b,c,e){c=c.length?c:new b.constructor(c);a.memcpy(b,0,c,e);return c};a.linspace=function(b,c,a){var d,g,f,i,a=a.length?(d=a.length)&&a:s(d=a);i=(c-b)/--d;for(f=b+i,g=1;g<d;g++,f+=i)a[g]=f;a[0]=b;a[d]=c;return a};a.ftoi=function(a,c,e){for(var d=k.pow(2,c-1),e=e||new a.constructor(a.length),
c=0;c<a.length;c++)e[c]=~~(d*a[c]);return e}})(this.Sink);(function(a){function b(c,b){a.EventEmitter.call(this);this.bufferSize=isNaN(c)||null===c?this.bufferSize:c;this.channelCount=isNaN(b)||null===b?this.channelCount:b;var d=this;this.callback=function(){return d.process.apply(d,arguments)};this.resetBuffer()}b.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new n(this.bufferSize);this.zeroBuffer=new n(this.bufferSize)},
process:function(c){null===this.offset&&this.loadBuffer();for(var a=0;a<c.length;a++)this.offset>=this.buffer.length&&this.loadBuffer(),c[a]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0;a.memcpy(this.zeroBuffer,0,this.buffer,0);this.emit("audioprocess",[this.buffer,this.channelCount])}};a.Proxy=b;a.prototype.createProxy=function(c){c=new a.Proxy(c,this.channelCount);c.parentSink=this;this.on("audioprocess",c.callback);return c}})(this.Sink);(function(a){function b(){this.ringBuffer&&
("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}a.on("init",function(a){a.on("preprocess",b)});a.prototype.ringBuffer=null;a.prototype.ringSpin=function(a){var b=this.ringBuffer,d=a.length,g=b.length,f=this.ringOffset,i;for(i=0;i<d;i++)a[i]+=b[f],f=(f+1)%g;this.ringOffset=f};a.prototype.ringSpinDeinterleaved=function(a){var b=this.ringBuffer,d=a.length,g=b.length,f=b[0].length,i=this.ringOffset,j,k;for(j=0;j<d;j+=g){for(k=0;k<g;k++)a[j+k]+=b[k][i];i=
(i+1)%f}this.ringOffset=k}})(this.Sink);(function(a,b){b=a.prototype;a.on("init",function(a){a.asyncBuffers=[];a.syncBuffers=[];a.on("preprocess",a.writeBuffersSync);a.on("postprocess",a.writeBuffersAsync)});b.writeMode="async";b.asyncBuffers=b.syncBuffers=null;b.writeBuffersAsync=function(a){var b=this.asyncBuffers,d=a.length,g,f,i,j,t;if(b)for(i=0;i<b.length;i++){g=b[i];f=g.b.length;t=g.d;g.d-=k.min(t,d);for(j=0;j+t<d&&j<f;j++)a[j+t]+=g.b[j];g.b=g.b.subarray(j+t);i>=f&&b.splice(i--,1)}};b.writeBuffersSync=
function(a){for(var b=this.syncBuffers,d=a.length,g=0,f=0;g<d&&b.length;g++)a[g]+=b[0][f],b[0].length<=f?(b.splice(0,1),f=0):f++;b.length&&(b[0]=b[0].subarray(f))};b.writeBufferAsync=function(b,e){var b="deinterleaved"===this.mode?a.interleave(b,this.channelCount):b,d=this.asyncBuffers;d.push({b:b,d:isNaN(e)?~~((+new Date-this.previousHit)/1E3*this.sampleRate):e});return d.length};b.writeBufferSync=function(b){var b="deinterleaved"===this.mode?a.interleave(b,this.channelCount):b,e=this.syncBuffers;
e.push(b);return e.length};b.writeBuffer=function(){return this["async"===this.writeMode?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)};b.getSyncWriteOffset=function(){var a=this.syncBuffers,b=0,d;for(d=0;d<a.length;d++)b+=a[d].length;return b}})(this.Sink);(function(a){function b(a){this.boundTo=a;this.buffers=[];a.activeRecordings.push(this)}a.on("init",function(a){a.activeRecordings=[];a.on("postprocess",a.recordData)});a.prototype.activeRecordings=null;a.prototype.record=function(){var b=
new a.Recording(this);this.emit("record",[b]);return b};a.prototype.recordData=function(a){var b=this.activeRecordings,d,g=b.length;for(d=0;d<g;d++)b[d].add(a)};b.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,d=this.buffers,g,f,i=d.length;for(f=0;f<i;f++)a+=d[f].length;a=new n(a);for(f=0;f<i;f++){for(g=0;g<d[f].length;g++)a[b+g]=
d[f][g];b+=d[f].length}return a}};a.Recording=b})(this.Sink);da.prototype={sampleRate:44100,attack:0.01,release:0.01,sample:0,pushSample:function(a){return this.sample=k.abs((a>this.sample?this.attack:this.release)*(this.sample-a)+a)},getMix:function(){return this.sample}};D.prototype={bufferPos:-1,pushSample:function(a){this.bufferPos=(this.bufferPos+1)%this.buffer.length;0===this.bufferPos&&this.process(this.buffer);return this.buffer[this.bufferPos]=a},getMix:function(){return this.buffer[this.bufferPos]},
resetBuffer:function(a){this.bufferSize=isNaN(a)?this.bufferSize:a;this.buffer=new n(this.bufferSize);this.bufferPos=-1}};m=function(){function a(a,b,i,j){var k=1,m=0,p=0.5*a.length,s=i.length,u,x,r,o;for(o=0;o<s;o++)if(r=i[o],k*=r,0===m?(u=a,x=b,m=1):(u=b,x=a,m=0),2===r){r=u;for(var v=x,y=j,A=0.5*r.length,w=0,H=0,D=A/2,A=A/k,z=k/2,G=1*z,M=new n(2),B=void 0,L=void 0,I=void 0,J=void 0,E=void 0,F=void 0,N=void 0,K=void 0,J=I=void 0,B=0;B<A;B++,H+=G){L=M;N=(y?d:-d)*B/(2*A);L[0]=e(N);L[1]=c(N);for(L=
0;L<z;L++,w++,H++)I=r[2*w],J=r[2*w+1],E=r[2*(w+D)],F=r[2*(w+D)+1],N=I+E,K=J+F,I-=E,J-=F,v[2*H]=N,v[2*H+1]=K,v[2*(H+z)]=M[0]*I-M[1]*J,v[2*(H+z)+1]=M[0]*J+M[1]*I}}if(j){if(1===m)for(o=0;o<p;o++)a[2*o]=b[2*o],a[2*o+1]=b[2*o+1]}else if(1===m)for(o=0;o<p;o++)a[2*o]=b[2*o]/p,a[2*o+1]=b[2*o+1]/p;else for(o=0;o<p;o++)a[2*o]/=p,a[2*o+1]/=p}function b(){this.reset.apply(this,arguments)}var c=k.sin,e=k.cos,d=2*k.PI;b.prototype={factors:null,scratch:null,bufferSize:2048,reset:function(a){this.bufferSize=isNaN(a)?
this.bufferSize:this.bufferSize;this.factors=[2,2,2,2,2,2,2,2,2,2];this.scratch=new n(this.bufferSize)},forward:function(b){a(b,this.scratch,this.factors,!0)},backward:function(b){a(b,this.scratch,this.factors,!1)}};return b}();(function(a){a.resetFFT=a.reset;a.reset=function(a,c){j.FourierTransform.apply(this,arguments);this.resetBuffer.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments);this.resetFFT.apply(this,[].slice.call(arguments,1))};a.process=function(a){this[this.method](a||
this.buffer);return this.calculateSpectrum()};a.setParam=function(a,c){switch(a){case "bufferSize":if(this.bufferSize===c)break;this.fullScratch=this.fullScratch||this.scratch;if(this.fullScratch.length<c)this.fullScratch=new n(c);this.scratch=this.fullScratch.subarray(0,c)}this[a]=c};a.resetScratch=function(){this.fullScratch=null;this.scratch=new n(this.bufferSize)};a.fullScratch=null;a.sampleRate=44100;a.method="forward"})(m.prototype);this.FourierTransform=function(){function a(b,e){for(var d in a.prototype)a.prototype.hasOwnProperty&&
(this[d]=a.prototype[d]);D.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments)}var b=k.sqrt;a.prototype={resetFT:function(a){this.sampleRate=isNaN(a)?this.sampleRate:a;this.bandWidth=0.5*2/this.bufferSize*this.sampleRate;this.spectrum=new n(0.5*this.bufferSize);this.peak=this.peakBand=0},getBandFrequency:function(a){return this.bandwidth*a+0.5*this.bandWidth},calculateSpectrum:function(){var a=this.spectrum,e=2/this.bufferSize,d=this.bufferSize/2,g,f,i;for(i=0;i<d;i++){g=this.buffer[2*
i];f=this.buffer[2*i+1];g=e*b(g*g+f*f);if(g>this.peak)this.peakBand=i,this.peak=g;a[i]=g}}};return a}();j.ADSREnvelope=V;j.StepSequencer=W;j.UIControl=X;j.BiquadFilter=p;j.BitCrusher=function(a,b){var c=this,e=0;c.sampleRate=a;c.resolution=b?k.pow(2,b-1):k.pow(2,7);c.pushSample=function(a){return e=k.floor(a*c.resolution+0.5)/c.resolution};c.getMix=function(){return e}};j.Chorus=function(a,b,c,e){function d(){f=new n(0.1*g.sampleRate);i=0;var a,b=f.length;for(a=0;a<b;a++)f[a]=0}var g=this,f,i,j;g.delayTime=
b||30;g.depth=c||3;g.freq=e||0.1;g.sampleRate=a;g.osc=new G(a,e);g.calcCoeff=d;g.pushSample=function(a){++i>=f.length&&(i=0);f[i]=a;g.osc.generate();a=g.delayTime+g.osc.getMix()*g.depth;a*=g.sampleRate/1E3;for(a=i-k.floor(a);0>a;)a+=f.length;return j=f[a]};g.getMix=function(){return j};d()};j.CombFilter=Y;j.Compressor=function(a,b,c){var e=this,d=0;e.sampleRate=a;e.scale=b||1;e.gain=isNaN(c)?0.5:c;e.pushSample=function(a){a/=e.scale;return d=(1+e.gain)*a-e.gain*a*a*a};e.getMix=function(){return d}};
j.Convolution=Z;j.Delay=E;j.Distortion=function(a){var b=new F(a,720.484),c=new F(a,723.431),e=new F(a,1),d=0;this.gain=4;this.master=1;this.sampleRate=a;this.filters=[b,c,e];this.pushSample=function(a){b.pushSample(a);d=b.getMix(1)*this.gain;d=k.atan(d)+d;0.4<d?d=0.4:-0.4>d&&(d=-0.4);c.pushSample(d);e.pushSample(c.getMix(0));return d=e.getMix(1)*this.master};this.getMix=function(){return d}};j.GainController=$;j.IIRFilter=F;j.LP12Filter=function(a,b,c){function e(){j=i*d.cutoff/d.samplerate;m=1-
j/(2*(d.resonance+0.5/(1+j))+j-2);n=m*m;p=n+1-2*k.cos(j)*m}var d=this,g=0,f=0,i=2*k.PI,j,m,n,p,s,u;d.cutoff=!b?2E4:b;d.resonance=!c?1:c;d.samplerate=a;d.pushSample=function(a){if(s!==d.cutoff||u!==d.resonance)e(),s=d.cutoff,u=d.resonance;g+=(a-f)*p;f+=g;g*=n;return f};d.getMix=function(){return f};e()};j.Limiter=aa;j.Reverb=v;j.Noise=ba;j.Oscillator=G;j.Sampler=ca;j.Amplitude=da;j.FFT=m;j.AudioProcessingUnit=D;j.AudioDevice=j.Sink=function(){return this}().Sink;(function(a,b){function c(a){return new j.BufferEffect(this,
a,[].slice.call(arguments,1))}function e(a,b,f,i){if(b){var f=f||b.prototype,j=b.prototype=new Q;j.name=j.fxid=a;e[a]=O(a,b,i);e[a].createBufferBased=b.createBufferBased=c;for(i in f)f.hasOwnProperty(i)&&(j[i]=f[i])}return e[a]}j.effects=e;for(b=0;b<a.length;b++)j[a[b]]=e(a[b],j[a[b]],j[a[b]].prototype);e("BiquadAllPassFilter",p.AllPass);e("BiquadBandPassFilter",p.BandPass);e("BiquadHighPassFilter",p.HighPass);e("BiquadLowPassFilter",p.LowPass);e("FreeverbAllPassFilter",v.AllPassFilter)})("BiquadFilter,BitCrusher,Chorus,CombFilter,Compressor,Convolution,Delay,Distortion,GainController,IIRFilter,LP12Filter,Limiter,Reverb,Amplitude,FFT".split(","));
(function(a,b){function c(a,b,g,f){if(b){var g=g||b.prototype,i=b.prototype=new R;i.name=i.fxid=a;c[a]=O(a,b,f);for(f in g)g.hasOwnProperty(f)&&(i[f]=g[f])}return c[a]}j.generators=c;for(b=0;b<a.length;b++)j[a[b]]=c(a[b],j[a[b]],j[a[b]].prototype)})("Noise,Oscillator,Sampler,ADSREnvelope,StepSequencer,UIControl".split(","));z("wav",j.PCMData);j.Automation=u;j.BufferEffect=U;j.EffectClass=Q;j.GeneratorClass=R;j.codecs=j.Codec=z;j.plugins=B;j.version="0.6.1";j.BufferEffect.prototype.addAutomation=j.EffectClass.prototype.addAutomation=
j.GeneratorClass.prototype.addAutomation=function(){return j.Automation.apply(j,[this].concat([].slice.call(arguments)))};return j}.call("undefined"===typeof exports?{}:this,this.window||global,Math,Object,Array);
audioLib.Binaural=audioLib.generators("BinauralTone",function(q,m,k){this.frequency=isNaN(m)?440:m;this.spread=isNaN(k)?10:k;this.sampleRate=q},{sampleRate:44100,frequency:440,spread:10,phaseOffset:0,pulseWidth:0.5,fm:0,phase:[0,0],_p:[0,0],generate:function(){var q=[+this.frequency,+this.frequency+this.spread],m=this.pulseWidth,k=this.phase;q[0]+=q[0]*this.fm;q[1]+=q[1]*this.fm;this.phase[0]=(k[0]+q[0]/this.sampleRate/2)%1;this.phase[1]=(k[1]+q[1]/this.sampleRate/2)%1;k[0]=(this.phase[0]+this.phaseOffset)%
1;k[1]=(this.phase[1]+this.phaseOffset)%1;this._p[0]=k[0]<m?k[0]/m:(k[0]-m)/(1-m);this._p[1]=k[1]<m?k[1]/m:(k[1]-m)/(1-m)},getMix:function(q){return Math.sin(2*this._p[q]*Math.PI)}});var Noise=function(){var q=this;q.dev=audioLib.Sink(function(m,k){q.generateBuffer(m,k)},2);this.bufferSize=this.dev.bufferSize;this.sampleRate=this.dev.sampleRate;this.actualVolume=this.volume=100;this.sources=[]};
Noise.prototype={addSource:function(q){console.log('Adding sound source "'+q().name+'". Total sources: '+(this.sources.length+1));var m=Array.prototype.slice.call(arguments);m[0]=this.sampleRate;q={volume:100,func:q.apply(this,m)};this.sources.push(q);return q},removeSource:function(q){console.log('Removing source "'+q.func.name+'".');this.sources.splice(this.sources.indexOf(q),1)},setVolume:function(q){this.volume=0>(100<q?100:q)?0:q;this.actualVolume=this.volume*this.volume*this.volume/1E6},generateBuffer:function(q,
m){for(var k=0;k<q.length;k+=m){for(var y=0;y<this.sources.length;y++){this.sources[y].func.generate();for(var s=0;s<m;s++)q[k+s]+=this.sources[y].func.getMix(s)}for(s=0;s<m;s++)q[k+s]*=this.actualVolume}}};
